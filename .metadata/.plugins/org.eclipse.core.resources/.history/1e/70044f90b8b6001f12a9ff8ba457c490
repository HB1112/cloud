<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page import="com.springmvc.domain.Product" %>
<%@ page import="com.springmvc.domain.SearchResult" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>검색 결과</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&family=Noto+Serif:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans', 'Noto Serif', Arial, sans-serif;
            background-color: #f8f9fa; /* 연한 배경색 */
        }
        .container {
            max-width: 1200px; /* 최대 너비 설정 */
            margin: auto; /* 가운데 정렬 */
        }
        h1 {
            color: #333; /* 제목 색상 */
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
            background-color: #fff; /* 카드 배경색 */
        }
        .product-card img {
            max-width: 100%;
            height: auto;
            margin-bottom: 10px;
        }
        .product-card h3 {
            font-size: 16px;
            font-weight: 500;
            margin: 10px 0; /* 제목과 다른 요소 간격 */
        }
        .product-card p {
            margin: 5px 0;
            color: #666;
        }
        .product-card a {
            text-decoration: none;
            color: #007bff;
        }
        .pagination a, .pagination strong {
            padding: 5px 10px;
            margin: 0 2px;
            text-decoration: none;
            border: 1px solid #ddd;
            border-radius: 5px;
            color: #333;
        }
        .pagination strong {
            background-color: #007bff;
            color: white;
        }
        .pagination a:hover {
            background-color: #f0f0f0;
        }
        .sort-select {
            width: auto; /* 드롭다운 너비 자동 조정 */
        }
    </style>
</head>
<body>
<%@ include file="menu.jsp"%>

<div class="container mt-4">
    <h1 class="mb-4">검색 결과</h1>

    <c:choose>
        <c:when test="${not empty searchResult.products}">
            <!-- Bootstrap Grid for Product Cards -->
            <div class="row">
                <c:forEach var="product" items="${searchResult.products}">
                    <div class="col-md-3 mb-4"> <!-- 한 줄에 4개, 아래 간격 추가 -->
                        <div class="product-card">
                            <img src="${product.image}" alt="${product.name}">
                            <h3>${product.name}</h3>
                            <p>가격: ${product.price}</p>
                            <p>카테고리: ${product.category}</p>
                            <p><a href="${product.link}" target="_blank">상세보기</a></p>
                        </div>
                    </div>
                </c:forEach>
            </div>

            <!-- Pagination -->
            <div class="pagination mt-4 text-center">
                <c:if test="${currentPage > 1}">
                    <a href="${pageContext.request.contextPath}/search?query=${query}&page=${currentPage - 1}&sort=${sort}">이전</a>
                </c:if>

                <c:forEach begin="${startPage}" end="${endPage}" var="pageNum">
                    <c:choose>
                        <c:when test="${pageNum == currentPage}">
                            <strong>${pageNum}</strong>
                        </c:when>
                        <c:otherwise>
                            <a href="${pageContext.request.contextPath}/search?query=${query}&page=${pageNum}&sort=${sort}">${pageNum}</a>
                        </c:otherwise>
                    </c:choose>
                </c:forEach>

                <c:if test="${currentPage < totalPages}">
                    <a href="${pageContext.request.contextPath}/search?query=${query}&page=${currentPage + 1}&sort=${sort}">다음</a>
                </c:if>
            </div>
        </c:when>
        <c:otherwise>
            <p class="text-center text-muted">검색 결과가 없습니다.</p>
        </c:otherwise>
    </c:choose>

    <!-- 검색 폼 -->
    <form action="${pageContext.request.contextPath}/search" method="GET" class="mb-4">
        <input type="hidden" name="query" value="${query}" />
        <input type="hidden" name="page" value="${currentPage}" />

        <label for="sort">정렬 기준:</label>
        <select name="sort" id="sort" class="form-control d-inline sort-select ml-2" onchange="this.form.submit()">
            <option value="sim" ${sort == 'sim' ? 'selected' : ''}>관련도 높은 순</option>
            <option value="price_low" ${sort == 'price_low' ? 'selected' : ''}>가격 낮은 순</option>
            <option value="price_high" ${sort == 'price_high' ? 'selected' : ''}>가격 높은 순</option>
            <option value="date" ${sort == 'date' ? 'selected' : ''}>날짜 순</option>
        </select>
    </form>
</div>

<%@ include file="footer.jsp"%>
</body>
</html>
